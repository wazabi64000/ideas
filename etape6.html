<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Étape 6 – Upload d’images | Boîte à Idées</title>
<link rel="stylesheet" href="public/css/styles.css">
</head>
<body>
<header>
<nav class="navbar">
<div class="nav-logo"><a href="index.html">Boîte à Idées</a></div>
<button class="nav-toggle" id="nav-toggle" aria-label="Menu">☰</button>
<ul class="nav-links" id="nav-links">
<li><a href="index.html">Introduction</a></li>
<li><a href="etape1.html">Étape 1</a></li>
<li><a href="etape2.html">Étape 2</a></li>
<li><a href="etape3.html">Étape 3</a></li>
<li><a href="etape4.html">Étape 4</a></li>
<li><a href="etape5.html">Étape 5</a></li>
<li><a href="etape6.html">Étape 6</a></li>
<li><a href="etape7.html">Étape 7</a></li>
<li><a href="etape8.html">Étape 8</a></li>
<li><a href="etape9.html">Étape 9</a></li>
<li><a href="etape10.html">Étape 10</a></li>
<li><a href="etape11.html">Étape 11</a></li>
<li><a href="recap.html">Récapitulatif</a></li>
</ul>
</nav>
</header>

<main>
<section id="introduction">
<h1>Étape 6 – Upload d’images avec Multer</h1>
<p>Nous allons permettre aux utilisateurs d’ajouter des images à leurs idées en utilisant Multer.</p>
</section>

<section id="outils">
<h2>Dépendances</h2>
<ul>
<li>multer – gestion des uploads de fichiers</li>
<li>Express – routes pour recevoir les fichiers</li>
</ul>
</section>

<section id="theorie">
<h2>Code côté serveur</h2>
<pre><code>
// server.js
import multer from 'multer';
const storage = multer.diskStorage({
  destination: function(req, file, cb) {
    cb(null, './public/uploads/');
  },
  filename: function(req, file, cb) {
    cb(null, Date.now() + '-' + file.originalname);
  }
});
const upload = multer({ storage: storage, limits: { fileSize: 2 * 1024 * 1024 } });

// Route création idée
app.post('/idees', authenticateToken, upload.single('image'), async (req, res) => {
  const { titre, description } = req.body;
  const image = req.file ? req.file.filename : null;
  await IdeeModel.create({ titre, description, image, createur: req.user.id });
  res.redirect('/idees');
});
</code></pre>
</section>

<section id="commandes">
<h2>Commandes</h2>
<pre><code>
# Créer dossier uploads
mkdir -p public/uploads
# Assurez-vous que le dossier est accessible en lecture
</code></pre>
</section>

<section id="recap">
<h2>Récapitulatif</h2>
<ul>
<li>Upload d’images intégré</li>
<li>Limite de taille 2 Mo</li>
<li>Images stockées dans public/uploads</li>
<li>Formulaire Twig mis à jour pour inclure un champ file</li>
</ul>
</section>

<section id="etape-suivante">
<p>Étape 7 : Intégration de Twig pour afficher dynamiquement les idées.</p>
</section>
</main>

<footer>
<p>Projet Boîte à Idées – Étape 6</p>
</footer>
<script src="public/js/script.js"></script>
</body>
</html>
